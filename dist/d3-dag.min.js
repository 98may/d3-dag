!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fs"),require("child_process")):"function"==typeof define&&define.amd?define(["exports","fs","child_process"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3=t.d3||{},t.fs,t.child_process)}(this,(function(t,e,r){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=i(e),o=i(r);class s{constructor(t){this.base=t}[Symbol.iterator](){return this}next(){const{value:t,done:e}=this.base.next();return e?{value:void 0,done:!0}:{value:t,done:!1}}concat(...t){return new s(function*(t){for(const e of t)yield*e}([this,...t.map(a)]))}entries(){return new s(function*(t){let e=0;for(const r of t)yield[e++,r]}(this))}every(t){return!this.some((e,r)=>!t(e,r))}fill(t){return this.map(()=>t)}filter(t){return new s(function*(e){for(const[r,i]of e)t(i,r)&&(yield i)}(this.entries()))}find(t){for(const[e,r]of this.entries())if(t(r,e))return r}findIndex(t){for(const[e,r]of this.entries())if(t(r,e))return e;return-1}flatMap(t){return new s(function*(e){for(const[r,i]of e)yield*a(t(i,r))}(this.entries()))}forEach(t){for(const[e,r]of this.entries())t(r,e)}includes(t,e=0){return this.indexOf(t,e)>=0}indexOf(t,e=0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[r,i]of this.entries())if(r>=e&&i===t)return r;return-1}join(t=","){return[...this].join(t)}keys(){return new s(function*(t){let e=0;for(const r of t)yield e++}(this))}lastIndexOf(t,e=1/0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let r=-1;for(const[i,n]of this.entries())i<=e&&n===t&&(r=i);return r}get length(){return this.reduce(t=>t+1,0)}map(t){return new s(function*(e){for(const[r,i]of e)yield t(i,r)}(this.entries()))}reduce(t,e){if(void 0===e){const e=t;let r=!0,i=void 0;for(const[t,n]of this.entries())r?(i=n,r=!1):i=e(i,n,t);if(r)throw new TypeError("Reduce of empty iterable with no initial value");return i}{const r=t;let i=e;for(const[t,e]of this.entries())i=r(i,e,t);return i}}reverse(){return a([...this].reverse())}slice(t=0,e=1/0){return new s(function*(r){for(const[i,n]of r)if(i<t);else{if(!(i<e))break;yield n}}(this.entries()))}some(t){for(const[e,r]of this.entries())if(t(r,e))return!0;return!1}sort(t){return a([...this].sort(t))}splice(t,e=0,...r){return new s(function*(i){for(const[n,o]of i)n===t&&(yield*r),(n<t||n>=t+e)&&(yield o)}(this.entries()))}values(){return this}}function a(t){return function(t){return"function"==typeof t[Symbol.iterator]}(t)?new s(t[Symbol.iterator]()):new s(t)}function h(t){if(void 0!==t)return t;throw new Error("got unexpected undefined value")}function l(t,e){e.size<t.size&&([e,t]=[t,e]);for(const r of t)if(e.has(r))return!0;return!1}class c extends Map{getThrow(t){const e=this.get(t);if(void 0===e)throw new Error("map doesn't contain key: "+t);return e}getDefault(t,e){const r=this.get(t);return void 0===r?e:r}setIfAbsent(t,e){const r=this.get(t);return void 0===r?(this.set(t,e),e):r}}class u{constructor(t,e,r=[]){this.child=t,this.data=e,this.points=r}}class f{constructor(t,e,r,i){this.source=t,this.target=e,this.data=r,this.points=i}}class d{constructor(t,e){this.id=t,this.data=e,this.dataChildren=[]}iroots(){return a([this])}roots(){return[this]}*iterChildren(){for(const{child:t}of this.dataChildren)yield t}ichildren(){return a(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:t,data:e,points:r}of this.dataChildren)yield new f(this,t,e,r)}ichildLinks(){return a(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new p([this])[Symbol.iterator]()}idescendants(t="depth"){return new p([this]).idescendants(t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return new p([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new p([this]).size()}sum(t){return new p([this]).sum(t),this}count(){return new p([this]).count(),this}height(){return new p([this]).height(),this}depth(){return new p([this]).depth(),this}split(){return[this]}connected(){return!0}}class p{constructor(t){this.dagRoots=t}[Symbol.iterator](){return this.idepth()}iroots(){return a(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const t=this.roots(),e=new Set;let r;for(;r=t.pop();)e.has(r.id)||(e.add(r.id),yield r,t.push(...r.ichildren()))}*ibreadth(){const t=new Set;let e=this.roots(),r=[];do{let i;for(r=e.reverse(),e=[];i=r.pop();)t.has(i.id)||(t.add(i.id),yield i,e.push(...i.ichildren()))}while(e.length)}*ibefore(){const t=new c;for(const e of this)for(const r of e.ichildren())t.set(r.id,t.getDefault(r.id,0)+1);const e=this.roots();let r;for(;r=e.pop();){yield r;for(const i of r.ichildren()){const r=t.getThrow(i.id);r>1?t.set(i.id,r-1):e.push(i)}}}*iafter(){const t=this.roots(),e=new Set;let r;for(;r=t.pop();)e.has(r.id)||(r.ichildren().every(t=>e.has(t.id))?(e.add(r.id),yield r):(t.push(r),t.push(...r.ichildren())))}idescendants(t="depth"){if("depth"===t)return a(this.idepth());if("breadth"===t)return a(this.ibreadth());if("before"===t)return a(this.ibefore());if("after"===t)return a(this.iafter());throw new Error("unknown iteration style: "+t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return this.idescendants().flatMap(t=>t.ichildLinks())}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce(t=>t+1,0)}sum(t){const e=new c;for(const[r,i]of this.idescendants("after").entries()){const n=t(i,r),o=new c;o.set(i.id,n);for(const t of i.ichildren()){const r=e.getThrow(t.id);for(const[t,e]of r.entries())o.set(t,e)}i.value=a(o.entries()).map(([,t])=>t).reduce((t,e)=>t+e),e.set(i.id,o)}return this}count(){const t=new c;for(const e of this.idescendants("after"))if(e.ichildren().next().done)t.set(e.id,new Set([e.id])),e.value=1;else{const r=new Set;for(const i of e.ichildren()){const e=t.getThrow(i.id);for(const t of e)r.add(t)}t.set(e.id,r),e.value=r.size}return this}height(){for(const t of this.idescendants("after"))t.value=Math.max(0,...t.ichildren().map(t=>{if(void 0===t.value)throw new Error("`after` iteration didn't iterate in after order");return t.value+1}));return this}depth(){const t=new c;for(const e of this)for(const r of e.ichildren())t.setIfAbsent(r.id,[]).push(e);for(const e of this.idescendants("before"))e.value=Math.max(0,...t.getDefault(e.id,[]).map(t=>{if(void 0===t.value)throw new Error("`before` iteration didn't iterate in before order");return t.value+1}));return this}split(){const t=new c,e=new c;for(const r of this.iroots())t.set(r.id,[]),e.set(r.id,new Set(r.idescendants().map(t=>t.id)));for(const[r,i]of this.iroots().entries()){const n=e.getThrow(i.id);for(const o of this.iroots().slice(r+1)){l(n,e.getThrow(o.id))&&(t.getThrow(i.id).push(o),t.getThrow(o.id).push(i))}}const r=[],i=new Set;for(const e of this.iroots())if(!i.has(e.id)){i.add(e.id);const n=[e];r.push(n);const o=t.getThrow(e.id).slice();let s;for(;s=o.pop();)i.has(s.id)||(i.add(s.id),n.push(s),o.push(...t.getThrow(s.id)))}return r.map(t=>t.length>1?new p(t):t[0])}connected(){return 1===this.split().length}}function v(t){if("string"!=typeof t)throw new Error("id is supposed to be string but got type "+typeof t);if(t.indexOf("\0")>=0)throw new Error(`node id ${t} contained null character`);return t}function m(t){if(!t.length)throw new Error("dag contained no roots");const e=new Set,r=new Set;let i=null;function n(t){if(e.has(t.id))return[];if(r.has(t.id))return i=t.id,[t.id];{r.add(t.id);let o=[];for(const e of t.ichildren())if(o=n(e),o.length)break;return r.delete(t.id),e.add(t.id),o.length&&null!==i&&o.push(t.id),i===t.id&&(i=null),o}}for(const e of t){const t=n(e);if(t.length)throw new Error("dag contained a cycle: "+t.reverse().join(" -> "))}for(const e of new p(t)){if(new Set(e.ichildren().map(t=>t.id)).size!==e.dataChildren.length)throw new Error(`node '${e.id}' contained duplicate children`)}}function g(t,e,r){function i(e){if(!e.length)throw new Error("can't stratify empty data");const i=e.map((e,r)=>new d(v(t(e,r)),e)),n=new Map;i.forEach(t=>{if(n.has(t.id))throw new Error("found a duplicate id: "+t.id);n.set(t.id,t)});const o=[];return i.forEach((t,e)=>{const i=r(t.data,e)||[];i.forEach(([e,r])=>{const i=n.get(e);if(!i)throw new Error("missing id: "+e);return i.dataChildren.push(new u(t,r)),i}),i.length||o.push(t)}),m(o),o.length>1?new p(o):o[0]}return i.id=function(i){return void 0===i?t:g(i,e,r)},i.parentData=function(e){return void 0===e?r:g(t,function(t){function e(e,r){return(t(e,r)||[]).map(([t])=>t)}return e.wrapped=t,e}(e),e)},i.parentIds=function(r){return void 0===r?e:g(t,r,y(r))},i}function y(t){function e(e,r){return(t(e,r)||[]).map(t=>[t,void 0])}return e.wrapped=t,e}function w(t){if(function(t){try{return"string"==typeof t.id}catch(t){return!1}}(t))return t.id;throw new Error("default id function expected datum to have an id field but got: "+t)}function x(t){if(function(t){try{const e=t.parentIds;return void 0===e||e instanceof Array&&e.every(t=>"string"==typeof t)}catch(t){return!1}}(t))return t.parentIds;throw new Error("default parentIds function expected datum to have a parentIds field but got: "+t)}function b(t,e){function r(r){if(!r.length)throw new Error("can't connect empty data");const i=new Map,n=new Map;for(const[o,s]of r.entries()){const r=v(t(s,o));let a=i.get(r);void 0===a&&(a=new d(r,void 0),i.set(r,a));const h=v(e(s,o));let l=i.get(h);void 0===l&&(l=new d(h,void 0),i.set(h,l)),a.dataChildren.push(new u(l,s)),n.set(r,n.get(r)||!1),n.set(h,!0)}const o=[];for(const[t,e]of n)e||o.push(h(i.get(t)));return m(o),o.length>1?new p(o):o[0]}return r.sourceId=function(r){return void 0===r?t:b(r,e)},r.targetId=function(r){return void 0===r?e:b(t,r)},r}function I(t){if(function(t){try{return"string"==typeof t[0]}catch(t){return!1}}(t))return t[0];throw new Error("default source id expected datum[0] to be a string but got datum: "+t)}function C(t){if(function(t){try{return"string"==typeof t[1]}catch(t){return!1}}(t))return t[1];throw new Error("default target id expected datum[1] to be a string but got datum: "+t)}function B(t,e,r){function i(...e){if(!e.length)throw new Error("must pass in at least one node");const i=new Map,n=[];function o(e){const r=v(t(e));let o=i.get(r);if(void 0===o)o=new d(r,e),i.set(r,o),n.push(o);else if(e!==o.data)throw new Error("found duplicate id with different data: "+r);return o}const s=e.map(o);let a,h=0;for(;a=n.pop();)a.dataChildren=(r(a.data,h++)||[]).map(([t,e])=>new u(o(t),e));const l=new Set(s.map(t=>t.id));for(const t of i.values())if(t.ichildren().some(t=>l.has(t.id)))throw new Error(`node ${t.id} pointed to a root`);return m(s),s.length>1?new p(s):s[0]}return i.id=function(i){return void 0===i?t:B(i,e,r)},i.children=function(r){return void 0===r?e:B(t,r,M(r))},i.childrenData=function(e){return void 0===e?r:B(t,function(t){function e(e,r){return(t(e,r)||[]).map(([t])=>t)}return e.wrapped=t,e}(e),e)},i}function M(t){function e(e,r){return(t(e,r)||[]).map(t=>[t,void 0])}return e.wrapped=t,e}function E(t){if(function(t){try{return"string"==typeof t.id}catch(t){return!1}}(t))return t.id;throw new Error("default id function expected datum to have an id field by got: "+t)}function V(t){if(function(t){try{const e=t.children;return void 0===e||e instanceof Array}catch(t){return!1}}(t))return t.children;throw new Error("default children function expected datum to have a children field but got: "+t)}function O(t,e,r,i){this.feasible=r,this.evaluation=e,this.bounded=i,this._tableau=t}var $=O;function j(t,e,r,i,n){$.call(this,t,e,r,i),this.iter=n}O.prototype.generateSolutionSet=function(){for(var t={},e=this._tableau,r=e.varIndexByRow,i=e.variablesPerIndex,n=e.matrix,o=e.rhsColumn,s=e.height-1,a=Math.round(1/e.precision),h=1;h<=s;h+=1){var l=i[r[h]];if(void 0!==l&&!0!==l.isSlack){var c=n[h][o];t[l.id]=Math.round((Number.EPSILON+c)*a)/a}}return t};var k=j;function z(t){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=t||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}j.prototype=Object.create($.prototype),j.constructor=j;var T=z;function _(t,e){this.priority=t,this.reducedCosts=new Array(e);for(var r=0;r<e;r+=1)this.reducedCosts[r]=0}z.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()},_.prototype.copy=function(){var t=new _(this.priority,this.reducedCosts.length);return t.reducedCosts=this.reducedCosts.slice(),t},z.prototype.setOptionalObjective=function(t,e,r){var i=this.objectivesByPriority[t];void 0===i&&(i=new _(t,Math.max(this.width,e+1)),this.objectivesByPriority[t]=i,this.optionalObjectives.push(i),this.optionalObjectives.sort((function(t,e){return t.priority-e.priority})));i.reducedCosts[e]=r},z.prototype.initialize=function(t,e,r,i){this.variables=r,this.unrestrictedVars=i,this.width=t,this.height=e;for(var n=new Array(t),o=0;o<t;o++)n[o]=0;this.matrix=new Array(e);for(var s=0;s<e;s++)this.matrix[s]=n.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=t+e-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars},z.prototype._resetMatrix=function(){var t,e,r=this.model.variables,i=this.model.constraints,n=r.length,o=i.length,s=this.matrix[0],a=!0===this.model.isMinimization?-1:1;for(t=0;t<n;t+=1){var h=r[t],l=h.priority,c=a*h.cost;0===l?s[t+1]=c:this.setOptionalObjective(l,t+1,c),e=r[t].index,this.rowByVarIndex[e]=-1,this.colByVarIndex[e]=t+1,this.varIndexByCol[t+1]=e}for(var u=1,f=0;f<o;f+=1){var d,p,v=i[f],m=v.index;this.rowByVarIndex[m]=u,this.colByVarIndex[m]=-1,this.varIndexByRow[u]=m;var g=v.terms,y=g.length,w=this.matrix[u++];if(v.isUpperBound){for(d=0;d<y;d+=1)p=g[d],w[this.colByVarIndex[p.variable.index]]=p.coefficient;w[0]=v.rhs}else{for(d=0;d<y;d+=1)p=g[d],w[this.colByVarIndex[p.variable.index]]=-p.coefficient;w[0]=-v.rhs}}},z.prototype.setModel=function(t){this.model=t;var e=t.nVariables+1,r=t.nConstraints+1;return this.initialize(e,r,t.variables,t.unrestrictedVariables),this._resetMatrix(),this},z.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},z.prototype.density=function(){for(var t=0,e=this.matrix,r=0;r<this.height;r++)for(var i=e[r],n=0;n<this.width;n++)0!==i[n]&&(t+=1);return t/(this.height*this.width)},z.prototype.setEvaluation=function(){var t=Math.round(1/this.precision),e=this.matrix[this.costRowIndex][this.rhsColumn],r=Math.round((Number.EPSILON+e)*t)/t;this.evaluation=r,0===this.simplexIters&&(this.bestPossibleEval=r)},z.prototype.getSolution=function(){var t=!0===this.model.isMinimization?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new k(this,t,this.feasible,this.bounded,this.branchAndCutIterations):new $(this,t,this.feasible,this.bounded)},T.prototype.simplex=function(){return this.bounded=!0,this.phase1(),!0===this.feasible&&this.phase2(),this},T.prototype.phase1=function(){for(var t=this.model.checkForCycles,e=[],r=this.matrix,i=this.rhsColumn,n=this.width-1,o=this.height-1,s=0;;){for(var a=0,h=-this.precision,l=1;l<=o;l++){!0===this.unrestrictedVars[this.varIndexByRow[l]];var c=r[l][i];c<h&&(h=c,a=l)}if(0===a)return this.feasible=!0,s;for(var u=0,f=-1/0,d=r[0],p=r[a],v=1;v<=n;v++){var m=p[v];if(!0===this.unrestrictedVars[this.varIndexByCol[v]]||m<-this.precision){var g=-d[v]/m;f<g&&(f=g,u=v)}}if(0===u)return this.feasible=!1,s;if(t){e.push([this.varIndexByRow[a],this.varIndexByCol[u]]);var y=this.checkForCycles(e);if(y.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+y[0]),this.model.messages.push("Length :"+y[1]),this.feasible=!1,s}this.pivot(a,u),s+=1}},T.prototype.phase2=function(){for(var t,e,r=this.model.checkForCycles,i=[],n=this.matrix,o=this.rhsColumn,s=this.width-1,a=this.height-1,h=this.precision,l=this.optionalObjectives.length,c=null,u=0;;){var f=n[this.costRowIndex];l>0&&(c=[]);for(var d=0,p=h,v=!1,m=1;m<=s;m++)t=f[m],e=!0===this.unrestrictedVars[this.varIndexByCol[m]],l>0&&-h<t&&t<h?c.push(m):e&&t<0?-t>p&&(p=-t,d=m,v=!0):t>p&&(p=t,d=m,v=!1);if(l>0)for(var g=0;0===d&&c.length>0&&g<l;){var y=[],w=this.optionalObjectives[g].reducedCosts;p=h;for(var x=0;x<c.length;x++)t=w[m=c[x]],e=!0===this.unrestrictedVars[this.varIndexByCol[m]],-h<t&&t<h?y.push(m):e&&t<0?-t>p&&(p=-t,d=m,v=!0):t>p&&(p=t,d=m,v=!1);c=y,g+=1}if(0===d)return this.setEvaluation(),this.simplexIters+=1,u;for(var b=0,I=1/0,C=(this.varIndexByRow,1);C<=a;C++){var B=n[C],M=B[o],E=B[d];if(!(-h<E&&E<h)){if(E>0&&h>M&&M>-h){I=0,b=C;break}var V=v?-M/E:M/E;V>h&&I>V&&(I=V,b=C)}}if(I===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[d],u;if(r){i.push([this.varIndexByRow[b],this.varIndexByCol[d]]);var O=this.checkForCycles(i);if(O.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+O[0]),this.model.messages.push("Length :"+O[1]),this.feasible=!1,u}this.pivot(b,d,!0),u+=1}};var R=[];function S(t,e,r,i){this.id=t,this.cost=e,this.index=r,this.value=0,this.priority=i}function A(t,e,r,i){S.call(this,t,e,r,i)}function N(t,e){S.call(this,t,0,e,0)}function P(t,e){this.variable=t,this.coefficient=e}function q(t,e,r){return 0===r||"required"===r?null:(e=e||1,r=r||1,!1===t.isMinimization&&(e=-e),t.addVariable(e,"r"+t.relaxationIndex++,!1,!1,r))}function F(t,e,r,i){this.slack=new N("s"+r,r),this.index=r,this.model=i,this.rhs=t,this.isUpperBound=e,this.terms=[],this.termsByVarIndex={},this.relaxation=null}function D(t,e){this.upperBound=t,this.lowerBound=e,this.model=t.model,this.rhs=t.rhs,this.relaxation=null}T.prototype.pivot=function(t,e){var r=this.matrix,i=r[t][e],n=this.height-1,o=this.width-1,s=this.varIndexByRow[t],a=this.varIndexByCol[e];this.varIndexByRow[t]=a,this.varIndexByCol[e]=s,this.rowByVarIndex[a]=t,this.rowByVarIndex[s]=-1,this.colByVarIndex[a]=-1,this.colByVarIndex[s]=e;for(var h,l,c,u=r[t],f=0,d=0;d<=o;d++)u[d]>=-1e-16&&u[d]<=1e-16?u[d]=0:(u[d]/=i,R[f]=d,f+=1);u[e]=1/i;this.precision;for(var p=0;p<=n;p++)if(p!==t&&!(r[p][e]>=-1e-16&&r[p][e]<=1e-16)){var v=r[p];if((h=v[e])>=-1e-16&&h<=1e-16)0!==h&&(v[e]=0);else{for(l=0;l<f;l++)(c=u[d=R[l]])>=-1e-16&&c<=1e-16?0!==c&&(u[d]=0):v[d]=v[d]-h*c;v[e]=-h/i}}var m=this.optionalObjectives.length;if(m>0)for(var g=0;g<m;g+=1){var y=this.optionalObjectives[g].reducedCosts;if(0!==(h=y[e])){for(l=0;l<f;l++)0!==(c=u[d=R[l]])&&(y[d]=y[d]-h*c);y[e]=-h/i}}},T.prototype.checkForCycles=function(t){for(var e=0;e<t.length-1;e++)for(var r=e+1;r<t.length;r++){var i=t[e],n=t[r];if(i[0]===n[0]&&i[1]===n[1]){if(r-e>t.length-r)break;for(var o=!0,s=1;s<r-e;s++){var a=t[e+s],h=t[r+s];if(a[0]!==h[0]||a[1]!==h[1]){o=!1;break}}if(o)return[e,r-e]}}return[]},A.prototype.isInteger=!0,N.prototype.isSlack=!0,F.prototype.addTerm=function(t,e){var r=e.index,i=this.termsByVarIndex[r];if(void 0===i)i=new P(e,t),this.termsByVarIndex[r]=i,this.terms.push(i),!0===this.isUpperBound&&(t=-t),this.model.updateConstraintCoefficient(this,e,t);else{var n=i.coefficient+t;this.setVariableCoefficient(n,e)}return this},F.prototype.removeTerm=function(t){return this},F.prototype.setRightHandSide=function(t){if(t!==this.rhs){var e=t-this.rhs;!0===this.isUpperBound&&(e=-e),this.rhs=t,this.model.updateRightHandSide(this,e)}return this},F.prototype.setVariableCoefficient=function(t,e){var r=e.index;if(-1!==r){var i=this.termsByVarIndex[r];if(void 0===i)this.addTerm(t,e);else if(t!==i.coefficient){var n=t-i.coefficient;!0===this.isUpperBound&&(n=-n),i.coefficient=t,this.model.updateConstraintCoefficient(this,e,n)}return this}console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.")},F.prototype.relax=function(t,e){this.relaxation=q(this.model,t,e),this._relax(this.relaxation)},F.prototype._relax=function(t){null!==t&&(this.isUpperBound?this.setVariableCoefficient(-1,t):this.setVariableCoefficient(1,t))},D.prototype.isEquality=!0,D.prototype.addTerm=function(t,e){return this.upperBound.addTerm(t,e),this.lowerBound.addTerm(t,e),this},D.prototype.removeTerm=function(t){return this.upperBound.removeTerm(t),this.lowerBound.removeTerm(t),this},D.prototype.setRightHandSide=function(t){this.upperBound.setRightHandSide(t),this.lowerBound.setRightHandSide(t),this.rhs=t},D.prototype.relax=function(t,e){this.relaxation=q(this.model,t,e),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var L={Constraint:F,Variable:S,IntegerVariable:A,SlackVariable:N,Equality:D,Term:P},U=L.SlackVariable;function H(t,e){this.index=t,this.value=e}T.prototype.addCutConstraints=function(t){for(var e,r=t.length,i=this.height,n=i+r,o=i;o<n;o+=1)void 0===this.matrix[o]&&(this.matrix[o]=this.matrix[o-1].slice());this.height=n,this.nVars=this.width+this.height-2;for(var s=this.width-1,a=0;a<r;a+=1){var h=t[a],l=i+a,c="min"===h.type?-1:1,u=h.varIndex,f=this.rowByVarIndex[u],d=this.matrix[l];if(-1===f){for(d[this.rhsColumn]=c*h.value,e=1;e<=s;e+=1)d[e]=0;d[this.colByVarIndex[u]]=c}else{var p=this.matrix[f],v=p[this.rhsColumn];for(d[this.rhsColumn]=c*(h.value-v),e=1;e<=s;e+=1)d[e]=-c*p[e]}var m=this.getNewElementIndex();this.varIndexByRow[l]=m,this.rowByVarIndex[m]=l,this.colByVarIndex[m]=-1,this.variablesPerIndex[m]=new U("s"+m,m),this.nVars+=1}},T.prototype._addLowerBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var r=e[t][this.rhsColumn],i=r-Math.floor(r);if(i<this.precision||1-this.precision<i)return!1;var n=this.height;e[n]=e[n-1].slice(),this.height+=1,this.nVars+=1;var o=this.getNewElementIndex();this.varIndexByRow[n]=o,this.rowByVarIndex[o]=n,this.colByVarIndex[o]=-1,this.variablesPerIndex[o]=new U("s"+o,o),e[n][this.rhsColumn]=Math.floor(r);for(var s=1;s<this.varIndexByCol.length;s+=1){if(this.variablesPerIndex[this.varIndexByCol[s]].isInteger){var a=e[t][s],h=Math.floor(a)+Math.max(0,a-Math.floor(a)-i)/(1-i);e[n][s]=h}else e[n][s]=Math.min(0,e[t][s]/(1-i))}for(var l=0;l<this.width;l+=1)e[n][l]-=e[t][l];return!0},T.prototype._addUpperBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var r=e[t][this.rhsColumn],i=r-Math.floor(r);if(i<this.precision||1-this.precision<i)return!1;var n=this.height;e[n]=e[n-1].slice(),this.height+=1,this.nVars+=1;var o=this.getNewElementIndex();this.varIndexByRow[n]=o,this.rowByVarIndex[o]=n,this.colByVarIndex[o]=-1,this.variablesPerIndex[o]=new U("s"+o,o),e[n][this.rhsColumn]=-i;for(var s=1;s<this.varIndexByCol.length;s+=1){var a=this.variablesPerIndex[this.varIndexByCol[s]],h=e[t][s],l=h-Math.floor(h);a.isInteger?e[n][s]=l<=i?-l:-(1-l)*i/l:e[n][s]=h>=0?-h:h*i/(1-i)}return!0},T.prototype.applyMIRCuts=function(){},T.prototype._putInBase=function(t){var e=this.rowByVarIndex[t];if(-1===e){for(var r=this.colByVarIndex[t],i=1;i<this.height;i+=1){var n=this.matrix[i][r];if(n<-this.precision||this.precision<n){e=i;break}}this.pivot(e,r)}return e},T.prototype._takeOutOfBase=function(t){var e=this.colByVarIndex[t];if(-1===e){for(var r=this.rowByVarIndex[t],i=this.matrix[r],n=1;n<this.height;n+=1){var o=i[n];if(o<-this.precision||this.precision<o){e=n;break}}this.pivot(r,e)}return e},T.prototype.updateVariableValues=function(){for(var t=this.variables.length,e=Math.round(1/this.precision),r=0;r<t;r+=1){var i=this.variables[r],n=i.index,o=this.rowByVarIndex[n];if(-1===o)i.value=0;else{var s=this.matrix[o][this.rhsColumn];i.value=Math.round((s+Number.EPSILON)*e)/e}}},T.prototype.updateRightHandSide=function(t,e){var r=this.height-1,i=this.rowByVarIndex[t.index];if(-1===i){for(var n=this.colByVarIndex[t.index],o=0;o<=r;o+=1){var s=this.matrix[o];s[this.rhsColumn]-=e*s[n]}var a=this.optionalObjectives.length;if(a>0)for(var h=0;h<a;h+=1){var l=this.optionalObjectives[h].reducedCosts;l[this.rhsColumn]-=e*l[n]}}else this.matrix[i][this.rhsColumn]-=e},T.prototype.updateConstraintCoefficient=function(t,e,r){if(t.index===e.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var i=this._putInBase(t.index),n=this.colByVarIndex[e.index];if(-1===n)for(var o=this.rowByVarIndex[e.index],s=0;s<this.width;s+=1)this.matrix[i][s]+=r*this.matrix[o][s];else this.matrix[i][n]-=r},T.prototype.updateCost=function(t,e){var r=t.index,i=this.width-1,n=this.colByVarIndex[r];if(-1===n){var o,s=this.matrix[this.rowByVarIndex[r]];if(0===t.priority){var a=this.matrix[0];for(o=0;o<=i;o+=1)a[o]+=e*s[o]}else{var h=this.objectivesByPriority[t.priority].reducedCosts;for(o=0;o<=i;o+=1)h[o]+=e*s[o]}}else this.matrix[0][n]-=e},T.prototype.addConstraint=function(t){var e=t.isUpperBound?1:-1,r=this.height,i=this.matrix[r];void 0===i&&(i=this.matrix[0].slice(),this.matrix[r]=i);for(var n=this.width-1,o=0;o<=n;o+=1)i[o]=0;i[this.rhsColumn]=e*t.rhs;for(var s=t.terms,a=s.length,h=0;h<a;h+=1){var l=s[h],c=l.coefficient,u=l.variable.index,f=this.rowByVarIndex[u];if(-1===f)i[this.colByVarIndex[u]]+=e*c;else{var d=this.matrix[f];d[this.rhsColumn];for(o=0;o<=n;o+=1)i[o]-=e*c*d[o]}}var p=t.index;this.varIndexByRow[r]=p,this.rowByVarIndex[p]=r,this.colByVarIndex[p]=-1,this.height+=1},T.prototype.removeConstraint=function(t){var e=t.index,r=this.height-1,i=this._putInBase(e),n=this.matrix[r];this.matrix[r]=this.matrix[i],this.matrix[i]=n,this.varIndexByRow[i]=this.varIndexByRow[r],this.varIndexByRow[r]=-1,this.rowByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.slack.index=-1,this.height-=1},T.prototype.addVariable=function(t){var e=this.height-1,r=this.width,i=!0===this.model.isMinimization?-t.cost:t.cost,n=t.priority,o=this.optionalObjectives.length;if(o>0)for(var s=0;s<o;s+=1)this.optionalObjectives[s].reducedCosts[r]=0;0===n?this.matrix[0][r]=i:(this.setOptionalObjective(n,r,i),this.matrix[0][r]=0);for(var a=1;a<=e;a+=1)this.matrix[a][r]=0;var h=t.index;this.varIndexByCol[r]=h,this.rowByVarIndex[h]=-1,this.colByVarIndex[h]=r,this.width+=1},T.prototype.removeVariable=function(t){var e=t.index,r=this._takeOutOfBase(e),i=this.width-1;if(r!==i){for(var n=this.height-1,o=0;o<=n;o+=1){var s=this.matrix[o];s[r]=s[i]}var a=this.optionalObjectives.length;if(a>0)for(var h=0;h<a;h+=1){var l=this.optionalObjectives[h].reducedCosts;l[r]=l[i]}var c=this.varIndexByCol[i];this.varIndexByCol[r]=c,this.colByVarIndex[c]=r}this.varIndexByCol[i]=-1,this.colByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.index=-1,this.width-=1},T.prototype.log=function(t,e){console.log("****",t,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var r,i,n,o,s,a,h,l,c,u,f="",d=[" "];for(i=1;i<this.width;i+=1)s=this.varIndexByCol[i],h=" ",l="\t",(a=void 0===(o=this.variablesPerIndex[s])?"c"+s:o.id).length>5?h+=" ":l+="\t",d[i]=h,f+=l+a;console.log(f);var p=this.matrix[this.costRowIndex],v="\t";for(r=1;r<this.width;r+=1)v+="\t",v+=d[r],v+=p[r].toFixed(5);for(v+="\t"+d[0]+p[0].toFixed(5),console.log(v+"\tZ"),n=1;n<this.height;n+=1){for(c=this.matrix[n],u="\t",i=1;i<this.width;i+=1)u+="\t"+d[i]+c[i].toFixed(5);u+="\t"+d[0]+c[0].toFixed(5),s=this.varIndexByRow[n],a=void 0===(o=this.variablesPerIndex[s])?"c"+s:o.id,console.log(u+"\t"+a)}console.log("");var m=this.optionalObjectives.length;if(m>0){console.log("    Optional objectives:");for(var g=0;g<m;g+=1){var y=this.optionalObjectives[g].reducedCosts,w="";for(r=1;r<this.width;r+=1)w+=y[r]<0?"":" ",w+=d[r],w+=y[r].toFixed(5);w+=(y[0]<0?"":" ")+d[0]+y[0].toFixed(5),console.log(w+" z"+g)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this},T.prototype.copy=function(){var t=new T(this.precision);t.width=this.width,t.height=this.height,t.nVars=this.nVars,t.model=this.model,t.variables=this.variables,t.variablesPerIndex=this.variablesPerIndex,t.unrestrictedVars=this.unrestrictedVars,t.lastElementIndex=this.lastElementIndex,t.varIndexByRow=this.varIndexByRow.slice(),t.varIndexByCol=this.varIndexByCol.slice(),t.rowByVarIndex=this.rowByVarIndex.slice(),t.colByVarIndex=this.colByVarIndex.slice(),t.availableIndexes=this.availableIndexes.slice();for(var e=[],r=0;r<this.optionalObjectives.length;r++)e[r]=this.optionalObjectives[r].copy();t.optionalObjectives=e;for(var i=this.matrix,n=new Array(this.height),o=0;o<this.height;o++)n[o]=i[o].slice();return t.matrix=n,t},T.prototype.save=function(){this.savedState=this.copy()},T.prototype.restore=function(){if(null!==this.savedState){var t,e,r=this.savedState,i=r.matrix;for(this.nVars=r.nVars,this.model=r.model,this.variables=r.variables,this.variablesPerIndex=r.variablesPerIndex,this.unrestrictedVars=r.unrestrictedVars,this.lastElementIndex=r.lastElementIndex,this.width=r.width,this.height=r.height,t=0;t<this.height;t+=1){var n=i[t],o=this.matrix[t];for(e=0;e<this.width;e+=1)o[e]=n[e]}var s=r.varIndexByRow;for(e=0;e<this.height;e+=1)this.varIndexByRow[e]=s[e];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var a=r.varIndexByCol;for(t=0;t<this.width;t+=1)this.varIndexByCol[t]=a[t];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var h=r.rowByVarIndex,l=r.colByVarIndex,c=0;c<this.nVars;c+=1)this.rowByVarIndex[c]=h[c],this.colByVarIndex[c]=l[c];if(r.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var u=0;u<r.optionalObjectives.length;u++){var f=r.optionalObjectives[u].copy();this.optionalObjectives[u]=f,this.optionalObjectivePerPriority[f.priority]=f}}}},T.prototype.getMostFractionalVar=function(){for(var t=0,e=null,r=null,i=this.model.integerVariables,n=i.length,o=0;o<n;o++){var s=i[o].index,a=this.rowByVarIndex[s];if(-1!==a){var h=this.matrix[a][this.rhsColumn],l=Math.abs(h-Math.round(h));t<l&&(t=l,e=s,r=h)}}return new H(e,r)},T.prototype.getFractionalVarWithLowestCost=function(){for(var t=1/0,e=null,r=null,i=this.model.integerVariables,n=i.length,o=0;o<n;o++){var s=i[o],a=s.index,h=this.rowByVarIndex[a];if(-1!==h){var l=this.matrix[h][this.rhsColumn];if(Math.abs(l-Math.round(l))>this.precision){var c=s.cost;t>c&&(t=c,e=a,r=l)}}}return new H(e,r)},T.prototype.countIntegerValues=function(){for(var t=0,e=1;e<this.height;e+=1)if(this.variablesPerIndex[this.varIndexByRow[e]].isInteger){var r=this.matrix[e][this.rhsColumn];(r-=Math.floor(r))<this.precision&&-r<this.precision&&(t+=1)}return t},T.prototype.isIntegral=function(){for(var t=this.model.integerVariables,e=t.length,r=0;r<e;r++){var i=this.rowByVarIndex[t[r].index];if(-1!==i){var n=this.matrix[i][this.rhsColumn];if(Math.abs(n-Math.round(n))>this.precision)return!1}}return!0},T.prototype.computeFractionalVolume=function(t){for(var e=-1,r=1;r<this.height;r+=1)if(this.variablesPerIndex[this.varIndexByRow[r]].isInteger){var i=this.matrix[r][this.rhsColumn];if(i=Math.abs(i),Math.min(i-Math.floor(i),Math.floor(i+1))<this.precision){if(!t)return 0}else-1===e?e=i:e*=i}return-1===e?0:e};var W=T;function J(t,e,r){this.type=t,this.varIndex=e,this.value=r}function G(t,e){this.relaxedEvaluation=t,this.cuts=e}function Z(t,e){return e.relaxedEvaluation-t.relaxedEvaluation}T.prototype.applyCuts=function(t){if(this.restore(),this.addCutConstraints(t),this.simplex(),this.model.useMIRCuts)for(var e=!0;e;){var r=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex(),this.computeFractionalVolume(!0)>=.9*r&&(e=!1)}},T.prototype.branchAndCut=function(){var t=[],e=0,r=this.model.tolerance,i=!0,n=1e99;this.model.timeout&&(n=Date.now()+this.model.timeout);for(var o=1/0,s=null,a=[],h=0;h<this.optionalObjectives.length;h+=1)a.push(1/0);var l,c=new G(-1/0,[]);for(t.push(c);t.length>0&&!0===i&&Date.now()<n;)if(l=this.model.isMinimization?this.bestPossibleEval*(1+r):this.bestPossibleEval*(1-r),r>0&&o<l&&(i=!1),!((c=t.pop()).relaxedEvaluation>o)){var u=c.cuts;if(this.applyCuts(u),e++,!1!==this.feasible){var f=this.evaluation;if(!(f>o)){if(f===o){for(var d=!0,p=0;p<this.optionalObjectives.length&&!(this.optionalObjectives[p].reducedCosts[0]>a[p]);p+=1)if(this.optionalObjectives[p].reducedCosts[0]<a[p]){d=!1;break}if(d)continue}if(!0===this.isIntegral()){if(this.__isIntegral=!0,1===e)return void(this.branchAndCutIterations=e);s=c,o=f;for(var v=0;v<this.optionalObjectives.length;v+=1)a[v]=this.optionalObjectives[v].reducedCosts[0]}else{1===e&&this.save();for(var m=this.getMostFractionalVar(),g=m.index,y=[],w=[],x=u.length,b=0;b<x;b+=1){var I=u[b];I.varIndex===g?"min"===I.type?w.push(I):y.push(I):(y.push(I),w.push(I))}var C=Math.ceil(m.value),B=Math.floor(m.value),M=new J("min",g,C);y.push(M);var E=new J("max",g,B);w.push(E),t.push(new G(f,y)),t.push(new G(f,w)),t.sort(Z)}}}}null!==s&&this.applyCuts(s.cuts),this.branchAndCutIterations=e};var Q={},Y=L.Constraint,K=L.Equality,X=L.Variable,tt=L.IntegerVariable;function et(t,e){this.tableau=new T(t),this.name=e,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var rt=et;et.prototype.minimize=function(){return this.isMinimization=!0,this},et.prototype.maximize=function(){return this.isMinimization=!1,this},et.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},et.prototype._addConstraint=function(t){var e=t.slack;this.tableau.variablesPerIndex[e.index]=e,this.constraints.push(t),this.nConstraints+=1,!0===this.tableauInitialized&&this.tableau.addConstraint(t)},et.prototype.smallerThan=function(t){var e=new Y(t,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},et.prototype.greaterThan=function(t){var e=new Y(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},et.prototype.equal=function(t){var e=new Y(t,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(e);var r=new Y(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(r),new K(e,r)},et.prototype.addVariable=function(t,e,r,i,n){if("string"==typeof n)switch(n){case"required":n=0;break;case"strong":n=1;break;case"medium":n=2;break;case"weak":n=3;break;default:n=0}var o,s=this.tableau.getNewElementIndex();return null==e&&(e="v"+s),null==t&&(t=0),null==n&&(n=0),r?(o=new tt(e,t,s,n),this.integerVariables.push(o)):o=new X(e,t,s,n),this.variables.push(o),this.tableau.variablesPerIndex[s]=o,i&&(this.unrestrictedVariables[s]=!0),this.nVariables+=1,!0===this.tableauInitialized&&this.tableau.addVariable(o),o},et.prototype._removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e?(this.constraints.splice(e,1),this.nConstraints-=1,!0===this.tableauInitialized&&this.tableau.removeConstraint(t),t.relaxation&&this.removeVariable(t.relaxation)):console.warn("[Model.removeConstraint] Constraint not present in model")},et.prototype.removeConstraint=function(t){return t.isEquality?(this._removeConstraint(t.upperBound),this._removeConstraint(t.lowerBound)):this._removeConstraint(t),this},et.prototype.removeVariable=function(t){var e=this.variables.indexOf(t);if(-1!==e)return this.variables.splice(e,1),!0===this.tableauInitialized&&this.tableau.removeVariable(t),this;console.warn("[Model.removeVariable] Variable not present in model")},et.prototype.updateRightHandSide=function(t,e){return!0===this.tableauInitialized&&this.tableau.updateRightHandSide(t,e),this},et.prototype.updateConstraintCoefficient=function(t,e,r){return!0===this.tableauInitialized&&this.tableau.updateConstraintCoefficient(t,e,r),this},et.prototype.setCost=function(t,e){var r=t-e.cost;return!1===this.isMinimization&&(r=-r),e.cost=t,this.tableau.updateCost(e,r),this},et.prototype.loadJson=function(t){this.isMinimization="max"!==t.opType;for(var e=t.variables,r=t.constraints,i={},n={},o=Object.keys(r),s=o.length,a=0;a<s;a+=1){var h,l,c=o[a],u=r[c],f=u.equal,d=u.weight,p=u.priority,v=void 0!==d||void 0!==p;if(void 0===f){var m=u.min;void 0!==m&&(h=this.greaterThan(m),i[c]=h,v&&h.relax(d,p));var g=u.max;void 0!==g&&(l=this.smallerThan(g),n[c]=l,v&&l.relax(d,p))}else{h=this.greaterThan(f),i[c]=h,l=this.smallerThan(f),n[c]=l;var y=new K(h,l);v&&y.relax(d,p)}}var w=Object.keys(e),x=w.length;this.tolerance=t.tolerance||0,t.timeout&&(this.timeout=t.timeout),t.options&&(t.options.timeout&&(this.timeout=t.options.timeout),0===this.tolerance&&(this.tolerance=t.options.tolerance||0),t.options.useMIRCuts&&(this.useMIRCuts=t.options.useMIRCuts),void 0===t.options.exitOnCycles?this.checkForCycles=!0:this.checkForCycles=t.options.exitOnCycles);for(var b=t.ints||{},I=t.binaries||{},C=t.unrestricted||{},B=t.optimize,M=0;M<x;M+=1){var E=w[M],V=e[E],O=V[B]||0,$=!!I[E],j=!!b[E]||$,k=!!C[E],z=this.addVariable(O,E,j,k);$&&this.smallerThan(1).addTerm(1,z);var T=Object.keys(V);for(a=0;a<T.length;a+=1){var _=T[a];if(_!==B){var R=V[_],S=i[_];void 0!==S&&S.addTerm(R,z);var A=n[_];void 0!==A&&A.addTerm(R,z)}}}return this},et.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length},et.prototype.solve=function(){return!1===this.tableauInitialized&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()},et.prototype.isFeasible=function(){return this.tableau.feasible},et.prototype.save=function(){return this.tableau.save()},et.prototype.restore=function(){return this.tableau.restore()},et.prototype.activateMIRCuts=function(t){this.useMIRCuts=t},et.prototype.debug=function(t){this.checkForCycles=t},et.prototype.log=function(t){return this.tableau.log(t)};var it={CleanObjectiveAttributes:function(t){var e,r,i;if("string"==typeof t.optimize){if(t.constraints[t.optimize]){for(r in e=Math.random(),t.variables)t.variables[r][t.optimize]&&(t.variables[r][e]=t.variables[r][t.optimize]);return t.constraints[e]=t.constraints[t.optimize],delete t.constraints[t.optimize],t}return t}for(i in t.optimize)if(t.constraints[i])if("equal"===t.constraints[i])delete t.optimize[i];else{for(r in e=Math.random(),t.variables)t.variables[r][i]&&(t.variables[r][e]=t.variables[r][i]);t.constraints[e]=t.constraints[i],delete t.constraints[i]}return t}};var nt=function(t){return t.length?function(t){var e={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},r={opType:"",optimize:"_obj",constraints:{},variables:{}},i={">=":"min","<=":"max","=":"equal"},n="",o=null,s="",a="",h="",l=0;"string"==typeof t&&(t=t.split("\n"));for(var c=0;c<t.length;c++)if(h="__"+c,n=t[c],o=null,e.is_objective.test(n))r.opType=n.match(/(max|min)/gi)[0],(o=n.match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")})).slice(1)).forEach((function(t){s=null===(s=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:s[0],s=parseFloat(s),a=t.match(e.get_word)[0].replace(/\;$/,""),r.variables[a]=r.variables[a]||{},r.variables[a]._obj=s}));else if(e.is_int.test(n))o=n.match(e.parse_int).slice(1),r.ints=r.ints||{},o.forEach((function(t){t=t.replace(";",""),r.ints[t]=1}));else if(e.is_bin.test(n))o=n.match(e.parse_bin).slice(1),r.binaries=r.binaries||{},o.forEach((function(t){t=t.replace(";",""),r.binaries[t]=1}));else if(e.is_constraint.test(n)){var u=n.indexOf(":");(o=(-1===u?n:n.slice(u+1)).match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")}))).forEach((function(t){s=null===(s=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:s[0],s=parseFloat(s),a=t.match(e.get_word)[0],r.variables[a]=r.variables[a]||{},r.variables[a][h]=s})),l=parseFloat(n.match(e.parse_rhs)[0]),n=i[n.match(e.parse_dir)[0]],r.constraints[h]=r.constraints[h]||{},r.constraints[h][n]=l}else e.is_unrestricted.test(n)&&(o=n.match(e.parse_int).slice(1),r.unrestricted=r.unrestricted||{},o.forEach((function(t){t=t.replace(";",""),r.unrestricted[t]=1})));return r}(t):function(t){if(!t)throw new Error("Solver requires a model to operate on");var e="",r={max:"<=",min:">=",equal:"="},i=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(t.opType)for(var n in e+=t.opType+":",t.variables)t.variables[n][n]=t.variables[n][n]?t.variables[n][n]:1,t.variables[n][t.optimize]&&(e+=" "+t.variables[n][t.optimize]+" "+n.replace(i,"_"));else e+="max:";for(var o in e+=";\n\n",t.constraints)for(var s in t.constraints[o])if(void 0!==r[s]){for(var a in t.variables)void 0!==t.variables[a][o]&&(e+=" "+t.variables[a][o]+" "+a.replace(i,"_"));e+=" "+r[s]+" "+t.constraints[o][s],e+=";\n"}if(t.ints)for(var h in e+="\n\n",t.ints)e+="int "+h.replace(i,"_")+";\n";if(t.unrestricted)for(var l in e+="\n\n",t.unrestricted)e+="unrestricted "+l.replace(i,"_")+";\n";return e}(t)};function ot(t){return t=(t=(t=t.replace("\\r\\n","\r\n")).split("\r\n")).filter((function(t){return!0!==new RegExp(" 0$","gi").test(t)&&!1!==new RegExp("\\d$","gi").test(t)})).map((function(t){return t.split(/\:{0,1} +(?=\d)/)})).reduce((function(t,e,r){return t[e[0]]=e[1],t}),{})}var st={lpsolve:{reformat:nt,solve:function(t){return new Promise((function(e,r){"undefined"!=typeof window&&r("Function Not Available in Browser");var i=nt(t);t.external||r("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),t.external.binPath||r("No Executable | Binary path provided in arguments as 'binPath'"),t.external.args||r("No arguments array for cli | bash provided on 'args' attribute"),t.external.tempName||r("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on"),n.default.writeFile(t.external.tempName,i,(function(i,n){if(i)r(i);else{var s=o.default.execFile;t.external.args.push(t.external.tempName),s(t.external.binPath,t.external.args,(function(t,i){if(t)if(1===t.code)e(ot(i));else{var n={code:t.code,meaning:{"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"}[t.code],data:i};r(n)}else e(ot(i))}))}}))}))}}},at=function(t,e){var r,i,n,o,s,a=e.optimize,h=JSON.parse(JSON.stringify(e.optimize)),l=Object.keys(e.optimize),c=0,u={},f="",d={},p=[];for(delete e.optimize,i=0;i<l.length;i++)h[l[i]]=0;for(i=0;i<l.length;i++){for(s in e.optimize=l[i],e.opType=a[l[i]],r=t.Solve(e,void 0,void 0,!0),l)if(!e.variables[l[s]])for(o in r[l[s]]=r[l[s]]?r[l[s]]:0,e.variables)e.variables[o][l[s]]&&r[o]&&(r[l[s]]+=r[o]*e.variables[o][l[s]]);for(f="base",n=0;n<l.length;n++)r[l[n]]?f+="-"+(1e3*r[l[n]]|0)/1e3:f+="-0";if(!u[f]){for(u[f]=1,c++,n=0;n<l.length;n++)r[l[n]]&&(h[l[n]]+=r[l[n]]);delete r.feasible,delete r.result,p.push(r)}}for(i=0;i<l.length;i++)e.constraints[l[i]]={equal:h[l[i]]/c};for(i in e.optimize="cheater-"+Math.random(),e.opType="max",e.variables)e.variables[i].cheater=1;for(i in p)for(o in p[i])d[o]=d[o]||{min:1e99,max:-1e99};for(i in d)for(o in p)p[o][i]?(p[o][i]>d[i].max&&(d[i].max=p[o][i]),p[o][i]<d[i].min&&(d[i].min=p[o][i])):(p[o][i]=0,d[i].min=0);return{midpoint:r=t.Solve(e,void 0,void 0,!0),vertices:p,ranges:d}},ht=L.Constraint,lt=L.Variable,ct=L.Numeral,ut=L.Term,ft=function(){this.Model=rt,this.branchAndCut=Q,this.Constraint=ht,this.Variable=lt,this.Numeral=ct,this.Term=ut,this.Tableau=W,this.lastSolvedModel=null,this.External=st,this.Solve=function(t,e,r,i){if(i)for(var n in it)t=it[n](t);if(!t)throw new Error("Solver requires a model to operate on");if("object"==typeof t.optimize&&Object.keys(t.optimize>1))return at(this,t);if(t.external){var o=Object.keys(st);if(o=JSON.stringify(o),!t.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+o);if(!st[t.external.solver])throw new Error("No support (yet) for "+t.external.solver+". Please use one of these instead:"+o);return st[t.external.solver].solve(t)}t instanceof rt==!1&&(t=new rt(e).loadJson(t));var s=t.solve();if(this.lastSolvedModel=t,s.solutionSet=s.generateSolutionSet(),r)return s;var a={};return a.feasible=s.feasible,a.result=s.evaluation,a.bounded=s.bounded,s._tableau.__isIntegral&&(a.isIntegral=!0),Object.keys(s.solutionSet).forEach((function(t){0!==s.solutionSet[t]&&(a[t]=s.solutionSet[t])})),a},this.ReformatLP=nt,this.MultiObjective=function(t){return at(this,t)}};"object"==typeof window?window.solver=new ft:"object"==typeof self&&(self.solver=new ft);var dt=new ft;function pt(t){function e(e){if(!e.connected())throw new Error("simplex() doesn't work with disconnected dags");const r=t?"":"\0",i=t?" -> ":"\0",n=Object.create(null),o=Object.create(null),s=Object.create(null);for(const t of e){const e=`${r}${t.id}`;o[e]=1,n[e]={opt:t.children.length}}for(const t of e.ilinks()){const e=n[`${r}${t.source.id}`],o=n[`${r}${t.target.id}`],a=`${t.source.id}${i}${t.target.id}`;s[a]={min:1},e[a]=-1,e.opt++,o[a]=1,o.opt--}const a=dt.Solve({optimize:"opt",opType:"max",constraints:s,variables:n,ints:o});for(const t of e)t.layer=a[`${r}${t.id}`]||0}return e.debug=function(e){return void 0===e?t:pt(e)},e}function vt(...t){if(t.length)throw new Error(`got arguments to simplex(${t}), but constructor takes no aruguments.`);return pt(!1)}function mt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function gt(t,e){let r;if(void 0===e)for(const e of t)null!=e&&(r<e||void 0===r&&e>=e)&&(r=e);else{let i=-1;for(let n of t)null!=(n=e(n,++i,t))&&(r<n||void 0===r&&n>=n)&&(r=n)}return r}function yt(t,e){let r;if(void 0===e)for(const e of t)null!=e&&(r>e||void 0===r&&e>=e)&&(r=e);else{let i=-1;for(let n of t)null!=(n=e(n,++i,t))&&(r>n||void 0===r&&n>=n)&&(r=n)}return r}function wt(t,e,r=0,i=t.length-1,n=mt){for(;i>r;){if(i-r>600){const o=i-r+1,s=e-r+1,a=Math.log(o),h=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*h*(o-h)/o)*(s-o/2<0?-1:1);wt(t,e,Math.max(r,Math.floor(e-s*h/o+l)),Math.min(i,Math.floor(e+(o-s)*h/o+l)),n)}const o=t[e];let s=r,a=i;for(xt(t,r,e),n(t[i],o)>0&&xt(t,r,i);s<a;){for(xt(t,s,a),++s,--a;n(t[s],o)<0;)++s;for(;n(t[a],o)>0;)--a}0===n(t[r],o)?xt(t,r,a):(++a,xt(t,a,i)),a<=e&&(r=a+1),e<=a&&(i=a-1)}return t}function xt(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function bt(t,e,r){if(i=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(i=+i)>=i&&(yield i)}}(t,r))).length){if((e=+e)<=0||i<2)return yt(t);if(e>=1)return gt(t);var i,n=(i-1)*e,o=Math.floor(n),s=gt(wt(t,o).subarray(0,o+1));return s+(yt(t.subarray(o+1))-s)*(n-o)}}function It(...t){if(t.length)throw new Error(`got arguments to median(${t}), but constructor takes no aruguments.`);return function(t,e){const r=new c;for(const[e,i]of t.entries())for(const t of i.ichildren())r.setIfAbsent(t.id,[]).push(e);const i=new c;let n=-1;for(const o of e){const e=bt(r.getDefault(o.id,[]),.5,void 0);void 0===e?(i.set(o.id,n),n=+!((n+1)/(t.length+1))*(t.length+1)-1):i.set(o.id,e)}e.sort((t,e)=>i.getThrow(t.id)-i.getThrow(e.id))}}function Ct(t){function e(e){e.slice(0,e.length-1).forEach((r,i)=>t(r,e[i+1]))}return e.order=function(e){return void 0===e?t:Ct(e)},e}function Bt(...t){if(t.length)throw new Error(`got arguments to twoLayer(${t}), but constructor takes no aruguments.`);return Ct(It())}let Mt,Et,Vt=1e-60;do{Vt+=Vt,Mt=1+.1*Vt,Et=1+.2*Vt}while(Mt<=1||Et<=1);var Ot=Vt;var $t=function(t,e,r){let i,n;for(let e=1;e<=r;e+=1){t[e][e]=1/t[e][e],n=-t[e][e];for(let r=1;r<e;r+=1)t[r][e]*=n;if(i=e+1,r<i)break;for(let o=i;o<=r;o+=1){n=t[e][o],t[e][o]=0;for(let r=1;r<=e;r+=1)t[r][o]+=n*t[r][e]}}};var jt=function(t,e,r,i){let n,o;for(n=1;n<=r;n+=1){o=0;for(let e=1;e<n;e+=1)o+=t[e][n]*i[e];i[n]=(i[n]-o)/t[n][n]}for(let e=1;e<=r;e+=1){n=r+1-e,i[n]/=t[n][n],o=-i[n];for(let e=1;e<n;e+=1)i[e]+=o*t[e][n]}};var kt=function(t,e,r,i){let n,o,s;for(let e=1;e<=r;e+=1){if(i[1]=e,s=0,n=e-1,n<1){if(s=t[e][e]-s,s<=0)break;t[e][e]=Math.sqrt(s)}else{for(let r=1;r<=n;r+=1){o=t[r][e];for(let i=1;i<r;i+=1)o-=t[i][e]*t[i][r];o/=t[r][r],t[r][e]=o,s+=o*o}if(s=t[e][e]-s,s<=0)break;t[e][e]=Math.sqrt(s)}i[1]=0}};var zt=function(t,e,r,i,n,o,s,a,h,l,c,u,f,d=0,p,v,m){let g,y,w,x,b,I,C,B,M,E,V,O,$,j;const k=Math.min(i,c);let z=2*i+k*(k+5)/2+2*c+1;for(let t=1;t<=i;t+=1)v[t]=e[t];for(let t=i+1;t<=z;t+=1)v[t]=0;for(let t=1;t<=c;t+=1)f[t]=0,o[t]=0;const T=[];if(0===m[1]){if(kt(t,r,i,T),0!==T[1])return void(m[1]=2);jt(t,r,i,e),$t(t,r,i)}else{for(let r=1;r<=i;r+=1){n[r]=0;for(let i=1;i<=r;i+=1)n[r]+=t[i][r]*e[i]}for(let r=1;r<=i;r+=1){e[r]=0;for(let o=r;o<=i;o+=1)e[r]+=t[r][o]*n[o]}}s[1]=0;for(let r=1;r<=i;r+=1){n[r]=e[r],s[1]+=v[r]*n[r],v[r]=0;for(let e=r+1;e<=i;e+=1)t[e][r]=0}s[1]=-s[1]/2,m[1]=0;const _=i,R=_+i,S=R+k,A=S+k+1,N=A+k*(k+1)/2,P=N+c;for(let t=1;t<=c;t+=1){I=0;for(let e=1;e<=i;e+=1)I+=a[e][t]*a[e][t];v[P+t]=Math.sqrt(I)}function q(){p[1]+=1,z=N;for(let t=1;t<=c;t+=1){z+=1,I=-h[t];for(let e=1;e<=i;e+=1)I+=a[e][t]*n[e];if(Math.abs(I)<Ot&&(I=0),t>u)v[z]=I;else if(v[z]=-Math.abs(I),I>0){for(let e=1;e<=i;e+=1)a[e][t]=-a[e][t];h[t]=-h[t]}}for(let t=1;t<=x;t+=1)v[N+f[t]]=0;w=0,b=0;for(let t=1;t<=c;t+=1)v[N+t]<b*v[P+t]&&(w=t,b=v[N+t]/v[P+t]);if(0===w){for(let t=1;t<=x;t+=1)o[f[t]]=v[S+t];return 999}return 0}function F(){for(let e=1;e<=i;e+=1){I=0;for(let r=1;r<=i;r+=1)I+=t[r][e]*a[r][w];v[e]=I}g=_;for(let t=1;t<=i;t+=1)v[g+t]=0;for(let e=x+1;e<=i;e+=1)for(let r=1;r<=i;r+=1)v[g+r]=v[g+r]+t[r][e]*v[e];O=!0;for(let t=x;t>=1;t-=1){I=v[t],z=A+t*(t+3)/2,g=z-t;for(let e=t+1;e<=x;e+=1)I-=v[z]*v[R+e],z+=e;I/=v[g],v[R+t]=I,f[t]<=u||(I<=0||(O=!1,y=t))}if(!O){C=v[S+y]/v[R+y];for(let t=1;t<=x;t+=1)f[t]<=u||v[R+t]<=0||(b=v[S+t]/v[R+t],b<C&&(C=b,y=t))}I=0;for(let t=_+1;t<=_+i;t+=1)I+=v[t]*v[t];if(Math.abs(I)<=Ot){if(O)return m[1]=1,999;for(let t=1;t<=x;t+=1)v[S+t]=v[S+t]-C*v[R+t];return v[S+x+1]=v[S+x+1]+C,700}I=0;for(let t=1;t<=i;t+=1)I+=v[_+t]*a[t][w];B=-v[N+w]/I,$=!0,O||C<B&&(B=C,$=!1);for(let t=1;t<=i;t+=1)n[t]+=B*v[_+t],Math.abs(n[t])<Ot&&(n[t]=0);s[1]+=B*I*(B/2+v[S+x+1]);for(let t=1;t<=x;t+=1)v[S+t]=v[S+t]-B*v[R+t];if(v[S+x+1]=v[S+x+1]+B,!$){I=-h[w];for(let t=1;t<=i;t+=1)I+=n[t]*a[t][w];if(w>u)v[N+w]=I;else if(v[N+w]=-Math.abs(I),I>0){for(let t=1;t<=i;t+=1)a[t][w]=-a[t][w];h[w]=-h[w]}return 700}x+=1,f[x]=w,z=A+(x-1)*x/2+1;for(let t=1;t<=x-1;t+=1)v[z]=v[t],z+=1;if(x===i)v[z]=v[i];else{for(let e=i;e>=x+1;e-=1)if(0!==v[e]&&(M=Math.max(Math.abs(v[e-1]),Math.abs(v[e])),E=Math.min(Math.abs(v[e-1]),Math.abs(v[e])),b=v[e-1]>=0?Math.abs(M*Math.sqrt(1+E*E/(M*M))):-Math.abs(M*Math.sqrt(1+E*E/(M*M))),M=v[e-1]/b,E=v[e]/b,1!==M))if(0===M){v[e-1]=E*b;for(let r=1;r<=i;r+=1)b=t[r][e-1],t[r][e-1]=t[r][e],t[r][e]=b}else{v[e-1]=b,V=E/(1+M);for(let r=1;r<=i;r+=1)b=M*t[r][e-1]+E*t[r][e],t[r][e]=V*(t[r][e-1]+b)-t[r][e],t[r][e-1]=b}v[z]=v[x]}return 0}function D(){if(z=A+y*(y+1)/2+1,g=z+y,0===v[g])return 798;if(M=Math.max(Math.abs(v[g-1]),Math.abs(v[g])),E=Math.min(Math.abs(v[g-1]),Math.abs(v[g])),b=v[g-1]>=0?Math.abs(M*Math.sqrt(1+E*E/(M*M))):-Math.abs(M*Math.sqrt(1+E*E/(M*M))),M=v[g-1]/b,E=v[g]/b,1===M)return 798;if(0===M){for(let t=y+1;t<=x;t+=1)b=v[g-1],v[g-1]=v[g],v[g]=b,g+=t;for(let e=1;e<=i;e+=1)b=t[e][y],t[e][y]=t[e][y+1],t[e][y+1]=b}else{V=E/(1+M);for(let t=y+1;t<=x;t+=1)b=M*v[g-1]+E*v[g],v[g]=V*(v[g-1]+b)-v[g],v[g-1]=b,g+=t;for(let e=1;e<=i;e+=1)b=M*t[e][y]+E*t[e][y+1],t[e][y+1]=V*(t[e][y]+b)-t[e][y+1],t[e][y]=b}return 0}function L(){g=z-y;for(let t=1;t<=y;t+=1)v[g]=v[z],z+=1,g+=1;return v[S+y]=v[S+y+1],f[y]=f[y+1],y+=1,y<x?797:0}function U(){return v[S+x]=v[S+x+1],v[S+x+1]=0,f[x]=0,x-=1,p[2]+=1,0}for(x=d,p[1]=0,p[2]=0,j=0;;){if(j=q(),999===j)return;for(;j=F(),0!==j;){if(999===j)return;if(700===j)if(y===x)U();else{for(;D(),j=L(),797===j;);U()}}}};var Tt={solveQP:function(t,e,r,i=[],n=0,o=[0,0]){const s=[],a=[],h=[],l=[],c=[],u=[];let f="";const d=t.length-1,p=r[1].length-1;if(!i)for(let t=1;t<=p;t+=1)i[t]=0;if(d!==t[1].length-1&&(f="Dmat is not symmetric!"),d!==e.length-1&&(f="Dmat and dvec are incompatible!"),d!==r.length-1&&(f="Amat and dvec are incompatible!"),p!==i.length-1&&(f="Amat and bvec are incompatible!"),(n>p||n<0)&&(f="Value of meq is invalid!"),""!==f)return{message:f};for(let t=1;t<=p;t+=1)a[t]=0,l[t]=0;const v=Math.min(d,p);for(let t=1;t<=d;t+=1)h[t]=0;s[1]=0;for(let t=1;t<=2*d+v*(v+5)/2+2*p+1;t+=1)c[t]=0;for(let t=1;t<=2;t+=1)u[t]=0;return zt(t,e,d,d,h,l,s,r,i,d,p,n,a,0,u,c,o),1===o[1]&&(f="constraints are inconsistent, no solution!"),2===o[1]&&(f="matrix D in quadratic function is not positive definite!"),{solution:h,Lagrangian:l,value:s,unconstrained_solution:e,iterations:u,iact:a,message:f}}};function _t(t,e,r,i,n=0){e.pop(),t.pop(),t.forEach(t=>t.pop()),r.forEach(t=>t.pop());const o=function(t,e,r,i,n){const o=[[0]],s=[0],a=[[0]],h=[0];for(const e of t){const t=[0];t.push(...e),o.push(t)}s.push(...e),a.push(...e.map(()=>[0]));for(const t of r)for(const[e,r]of t.entries())a[e+1].push(-r);h.push(...i.map(t=>-t));const{solution:l,message:c}=Tt.solveQP(o,s,a,h,n);if(c.length)throw new Error("quadprog failed with: "+c);return l.shift(),l}(t,e,r,i,n);return o.push(0),o}function Rt(t){const e=new c;let r=0;for(const i of t)for(const t of i)e.set(t.id,r++);return e}function St(t,e,r){const i=1+Math.max(...e.values()),n=[],o=[];for(const s of t){let[t,...a]=s;for(const s of a){const a=e.getThrow(t.id),h=e.getThrow(s.id),l=new Array(i).fill(0);l[a]=1,l[h]=-1,n.push(l),o.push(-r(t,s)),t=s}}const s=new Array(i).fill(0);return[new Array(i).fill(null).map(()=>new Array(i).fill(0)),s,n,o]}function At(t,e,r,i){t[r][r]+=i,t[r][e]-=i,t[e][r]-=i,t[e][e]+=i}function Nt(t,e,r,i,n){t[i][i]+=n,t[i][r]-=2*n,t[i][e]+=n,t[r][i]-=2*n,t[r][r]+=4*n,t[r][e]-=2*n,t[e][i]+=n,t[e][r]-=2*n,t[e][e]+=n}function Pt(t,e,r){const i=Math.min(...r),n=Math.max(...r)-i;for(const o of t)for(const t of o){const o=e.getThrow(t.id);t.x=(r[o]-i)/n}}class qt extends d{constructor(t){super(t,void 0)}}function Ft(...t){if(t.length)throw new Error(`got arguments to vert(${t}), but constructor takes no aruguments.`);return function(t,e){const r=Rt(t),[i,n,o,s]=St(t,r,e);for(const e of t)for(const t of e){const e=r.getThrow(t.id);for(const n of t.ichildren()){const o=r.getThrow(n.id);if(t instanceof qt||At(i,e,o,.5),n instanceof qt)for(const t of n.ichildren()){Nt(i,e,o,r.getThrow(t.id),.5)}else At(i,e,o,.5)}}Pt(t,r,_t(i,n,o,s))}}function Dt(t,e,r,i,n,o,s){const[a,h]=n;function l(n){t(n);for(const t of n){const e=t.layer;if(void 0===e)throw new Error(`layering did not assign layer to node '${t.id}'`);if(e<0)throw new Error(`layering assigned a negative layer (${e}) to node '${t.id}'`)}const l=function(t){const e=[];for(const r of t.descendants()){const t=r.layer;(e[t]||(e[t]=[])).push(r),r.dataChildren=r.dataChildren.map(i=>{const n=i.child.layer;if(n<=t)throw new Error(`layering left child node "${i.child.id}" (${n}) with a greater or equal layer to parent node "${r.id}" (${t})`);let o=i.child;for(let a=n-1;a>t;a--){let t;t=s?`${r.id}->${i.child.id} (${a})`:`${r.id}\0${i.child.id}\0${a}`;const n=new qt(t);n.dataChildren.push(new u(o,void 0)),(e[a]||(e[a]=[])).push(n),o=n}return new u(o,i.data)})}return e}(n);if(1===l.length){const[t]=l;t.forEach(t=>t.y=h/2)}else{const t=i?h:h/(l.length-1);l.forEach((e,r)=>e.forEach(e=>e.y=t*r))}if(l.every(t=>1===t.length))l.forEach(([t])=>t.x=a/2);else{e(l),r(l,o);for(const t of l)for(const e of t)if(void 0===e.x)throw new Error(`coord didn't assign an x to node '${e.id}'`);const t=l,n=Math.min(...t.filter(t=>t.length>1).map(t=>Math.min(...t.slice(1).map((e,r)=>e.x-t[r].x)))),s=i?n:1;for(const e of t)for(const t of e)t.x*=a/s}const c=n;return function(t){for(const e of t)e instanceof qt||(e.dataChildren=e.dataChildren.map(t=>{let r=t.child;const i=[{x:e.x,y:e.y}];for(;r instanceof qt;)i.push({x:r.x,y:r.y}),[r]=r.ichildren();return i.push({x:r.x,y:r.y}),new u(r,t.data,i)}))}(c),c}return l.layering=function(a){return void 0===a?t:Dt(a,e,r,i,n,o,s)},l.decross=function(a){return void 0===a?e:Dt(t,a,r,i,n,o,s)},l.coord=function(a){return void 0===a?r:Dt(t,e,a,i,n,o,s)},l.size=function(a){return void 0!==a?Dt(t,e,r,!1,a,o,s):i?null:n},l.nodeSize=function(a){return void 0!==a?Dt(t,e,r,!0,a,o,s):i?n:null},l.separation=function(a){return void 0===a?o:Dt(t,e,r,i,n,a,s)},l.debug=function(a){return void 0===a?s:Dt(t,e,r,i,n,o,a)},l}function Lt(){return 1}function Ut(t){function e(e){if(t)for(const t of e.depth())t.layer=t.value;else!function(t){const e=Math.max(...t.iroots().map(t=>t.value));for(const r of t)r.layer=e-r.value}(e.height())}return e.topDown=function(e){return void 0===e?t:Ut(e)},e}function Ht(...t){if(t.length)throw new Error(`got arguments to longestPath(${t}), but constructor takes no aruguments.`);return Ut(!0)}var Wt=function(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}((function(t){var e=function(t,e){return t<e};function r(t){if(!(this instanceof r))return new r(t);this.array=[],this.size=0,this.compare=t||e}r.prototype.clone=function(){var t=new r(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},r.prototype.add=function(t){var e,r,i=this.size;for(this.array[this.size]=t,this.size+=1;i>0&&(e=i-1>>1,r=this.array[e],this.compare(t,r));)this.array[i]=r,i=e;this.array[i]=t},r.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},r.prototype._percolateUp=function(t,e){for(var r,i,n=this.array[t];t>0&&(r=t-1>>1,i=this.array[r],e||this.compare(n,i));)this.array[t]=i,t=r;this.array[t]=n},r.prototype._percolateDown=function(t){for(var e,r,i,n=this.size,o=this.size>>>1,s=this.array[t];t<o&&(r=(e=1+(t<<1))+1,i=this.array[e],r<n&&this.compare(this.array[r],i)&&(e=r,i=this.array[r]),this.compare(i,s));)this.array[t]=i,t=e;this.array[t]=s},r.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},r.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},r.prototype._batchRemove=function(t,e){var r=new Array(e||this.size),i=0;if("function"==typeof t&&this.size)for(var n=0;n<this.size&&i<r.length;)t(this.array[n])?(r[i]=this._removeAt(n),i++,n>>=1):n++;return r.length=i,r},r.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},r.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},r.prototype.peek=function(){if(0!=this.size)return this.array[0]},r.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},r.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},r.prototype.trim=function(){this.array=this.array.slice(0,this.size)},r.prototype.isEmpty=function(){return 0===this.size},r.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,r=this.clone();!r.isEmpty();)t(r.poll(),e++)},r.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,i=this.array,n=new r((function(t,r){return e(i[t],i[r])}));t=Math.min(this.size,t);var o=new Array(t),s=0;for(n.add(0);s<t;){var a=n.poll();o[s++]=this.array[a];var h=1+(a<<1),l=h+1;h<this.size&&n.add(h),l<this.size&&n.add(l)}return o};require.main===t&&function(){var t=new r((function(t,e){return t<e}));for(t.add(1),t.add(0),t.add(5),t.add(4),t.add(3);!t.isEmpty();)console.log(t.poll())}(),t.exports=r}));class Jt{constructor(){this.before=[],this.parents=[]}}function Gt(t){function e(e){const r=t||Math.floor(Math.sqrt(e.size()+.5)),i=new c(e.idescendants().map(t=>[t.id,new Jt]));for(const t of e)for(const e of t.ichildren())i.getThrow(e.id).parents.push(t);const n=new Wt((function(t,e){const r=i.getThrow(t.id).before,n=i.getThrow(e.id).before;for(const[t,e]of r.entries()){const r=n[t];if(void 0===r)return!1;if(e<r)return!0;if(r<e)return!1}return!0}));for(const t of e.iroots())n.add(t);let o,s=0,a=0,l=0;for(;o=n.poll();){l<r&&i.getThrow(o.id).parents.every(t=>h(t.layer)<a)?(o.layer=a,l++):(o.layer=++a,l=1);for(const t of o.ichildren()){const{before:e,parents:r}=i.getThrow(t.id);e.push(s),e.length===r.length&&(e.sort((t,e)=>e-t),n.add(t))}s++}}return e.width=function(e){if(void 0===e)return t;if(e<0)throw new Error("width must be non-negative: "+e);return Gt(e)},e}function Zt(t){const e=t?" => ":"\0\0",r=t?" ":"\0\0\0";function i(...t){return t.map(t=>t.id).sort().join(e)}function n(t,e){e.sort((t,e)=>+(t.id>e.id)||-1);for(const[r,n]of e.slice(0,e.length-1).entries())for(const o of e.slice(r+1)){const e=i(n,o);t.ints[e]=1,t.constraints[e]=Object.assign(Object.create(null),{max:1}),t.variables[e]=Object.assign(Object.create(null),{opt:0,[e]:1})}for(const[r,n]of e.slice(0,e.length-1).entries())for(const[o,s]of e.slice(r+1).entries())for(const a of e.slice(r+o+2)){const e=i(n,s),r=i(n,a),o=i(s,a),h=i(n,s,a),l=h+"+";t.constraints[l]=Object.assign(Object.create(null),{max:1}),t.variables[e][l]=1,t.variables[r][l]=-1,t.variables[o][l]=1;const c=h+"-";t.constraints[c]=Object.assign(Object.create(null),{min:0}),t.variables[e][c]=1,t.variables[r][c]=-1,t.variables[o][c]=1}}function o(e,n){for(const[o,s]of n.slice(0,n.length-1).entries())for(const a of n.slice(o+1)){const n=i(s,a);for(const o of s.ichildren())for(const s of a.ichildren()){if(o===s)continue;const a=i(o,s),h=t?`slack (${n}) (${a})`:`${n}\0\0\0${a}`,l=`${h}${r}+`,c=`${h}${r}-`;e.variables[h]=Object.assign(Object.create(null),{opt:1,[l]:1,[c]:1});const u=+(o.id>s.id),f=u||-1;e.constraints[l]=Object.assign(Object.create(null),{min:u}),e.variables[n][l]=1,e.variables[a][l]=f,e.constraints[c]=Object.assign(Object.create(null),{min:-u}),e.variables[n][c]=-1,e.variables[a][c]=-f}}}function s(t){const e={optimize:"opt",opType:"min",constraints:Object.create(null),variables:Object.create(null),ints:Object.create(null)};for(const r of t)n(e,r);for(const r of t.slice(0,t.length-1))o(e,r);const r=dt.Solve(e);for(const e of t)e.sort((t,e)=>(+(t.id>e.id)||-1)*(r[i(t,e)]||-1))}return s.debug=function(e){return void 0===e?t:Zt(e)},s}function Qt(t){function e(e,r){const i=Rt(e),[n,o,s,a]=St(e,i,r);for(const r of e)for(const e of r){const r=i.getThrow(e.id);for(const o of e.ichildren()){const e=i.getThrow(o.id);At(n,r,e,1-t);for(const s of o.ichildren()){Nt(n,r,e,i.getThrow(s.id),t)}}}Pt(e,i,_t(n,o,s,a))}return e.weight=function(e){if(void 0===e)return t;if(e<0||e>=1)throw new Error("weight must be in [0, 1), but was "+t);return Qt(e)},e}function Yt(t,e){for(const t of e)t.x=0;const r=new c;for(const e of t)for(const t of e.ichildren()){if(void 0===t.x)throw new Error(`unexpected undefined x for '${t.id}'`);const i=r.getDefault(t.id,0)+1;r.set(t.id,i),t.x+=(h(e.x)-t.x)/i}}class Kt{constructor(){this.mean=0,this.count=0}add(t){this.mean+=(t-this.mean)/++this.count}}function Xt(t){const e=t?" => ":"\0\0";function r(...t){return t.map(t=>t.id).sort().join(e)}function i(t,e){const i={optimize:"opt",opType:"min",constraints:Object.create(null),variables:Object.create(null),ints:Object.create(null)};e.sort((t,e)=>+(t.id>e.id)||-1);for(const[t,n]of e.slice(0,e.length-1).entries())for(const o of e.slice(t+1)){const t=r(n,o);i.ints[t]=1,i.constraints[t]=Object.assign(Object.create(null),{max:1}),i.variables[t]=Object.assign(Object.create(null),{opt:0,[t]:1})}for(const[t,n]of e.slice(0,e.length-1).entries())for(const[o,s]of e.slice(t+1).entries())for(const a of e.slice(t+o+2)){const t=r(n,s),e=r(n,a),o=r(s,a),h=r(n,s,a),l=h+"+";i.constraints[l]=Object.assign(Object.create(null),{max:1}),i.variables[t][l]=1,i.variables[e][l]=-1,i.variables[o][l]=1;const c=h+"-";i.constraints[c]=Object.assign(Object.create(null),{min:0}),i.variables[t][c]=1,i.variables[e][c]=-1,i.variables[o][c]=1}for(const[e,n]of t.slice(0,t.length-1).entries())for(const o of t.slice(e+1))for(const t of n.ichildren())for(const e of o.ichildren()){if(t===e)continue;const n=r(t,e);i.variables[n].opt+=+(t.id>e.id)||-1}const n=dt.Solve(i);e.sort((t,e)=>(+(t.id>e.id)||-1)*(+n[r(t,e)]||-1))}return i.debug=function(e){return void 0===e?t:Xt(e)},i}function te(t,e){const r=t.findIndex(t=>t<=e);return r>=0?r:t.length}function ee(t,e){function r(r){if(!r.connected())throw new Error("zherebko() doesn't work well for unconnected dags");const i=function(t){const e=[...t.idescendants("before")];for(const[t,r]of e.entries())r.layer=t;return e}(r),n=i.length-1;if(0===n){const[r]=i;r.x=t/2,r.y=e/2}else{!function(r,i,n){let o=0,s=0;for(const{source:t,target:e}of r.ilinks())if(e.layer>t.layer+1){const r=i.get(`${t.id}\0${e.id}`);if(void 0===r)throw new Error(`indexer didn't index ${t.id} -> ${e.id}`);o=Math.min(o,r),s=Math.max(s,r)}o===s&&(o=-1,s=1);for(const i of r)i.x=-o/(s-o)*t,i.y=i.layer/n*e;!function(r,i,n,o,s){for(const{source:a,target:h,points:l}of r.ilinks()){if(l.length=0,l.push({x:a.x,y:a.y}),h.layer-a.layer>1){const r=i.get(`${a.id}\0${h.id}`);if(void 0===r)throw new Error(`indexer didn't index ${a.id} -> ${h.id}`);const c=(r-o)/(s-o)*t,u=(a.layer+1)/n*e,f=(h.layer-1)/n*e;h.layer-a.layer>2?l.push({x:c,y:u},{x:c,y:f}):l.push({x:c,y:u})}l.push({x:h.x,y:h.y})}}(r,i,n,o,s)}(r,function(t){const e=new Map,r=[],i=[];for(const n of t)for(const t of n.children().sort((t,e)=>t.layer-e.layer)){const o=`${n.id}\0${t.id}`;if(t.layer>n.layer+1){const s=te(i,n.layer),a=te(r,n.layer);s<a?(e.set(o,-s-1),i[s]=t.layer-1):(e.set(o,a+1),r[a]=t.layer-1)}}return e}(i),n)}return r}return r.size=function(r){if(void 0===r)return[t,e];{const[t,e]=r;return ee(t,e)}},r}function re(t){function e(e){const r=new c,i=new c;for(const t of e.slice().reverse())for(const e of t){r.set(e.id,e);let t=0;for(const n of e.ichildren())r.delete(n.id),t+=i.getThrow(n.id);i.set(e.id,Math.max(t,1))}let n=0;for(const e of r.values()){const r=i.getThrow(e.id);e.columnIndex=n+(t?Math.floor((r-1)/2):0),o(e,n),n+=r}function o(e,r){let n=r;for(const r of e.ichildren()){if(void 0!==r.columnIndex)return;const e=i.getThrow(r.id);r.columnIndex=n+(t?Math.floor((e-1)/2):0),o(r,n),n+=e}}}return e.center=function(e){return void 0===e?t:re(e)},e}function ie(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return re(!1)}function ne(...t){if(t.length)throw new Error(`got arguments to spread(${t}), but constructor takes no aruguments.`);return function(t,e,r){const i=Math.max(...t.map(t=>Math.max(...t.map(t=>t.columnIndex))))+1,n=[];for(let t=0;t<i;++t)n.push(e(t));const o=[0];for(let t=0;t<i-1;++t){const e=o[t]+n[t]+r(t);o.push(e)}const s=o[i-1]+n[i-1];for(const e of t)for(const t of e){const e=o[t.columnIndex],r=n[t.columnIndex];t.x0=e/s,t.x1=(e+r)/s}}}class oe extends d{constructor(t){super(t,void 0)}}function se(t,e,r,i,n,o,s,a,h,l,f){function d(d){const p=function(t){const e=new c;for(const r of t.idescendants("after")){const t=Math.max(0,...r.ichildren().map(t=>e.getThrow(t.id)));e.set(r.id,f(r)+t)}return e}(d);i(d);for(const t of d){const e=t.layer;if(void 0===e)throw new Error(`layering did not assign layer to node '${t.id}'`);if(e<0)throw new Error(`layering assigned a negative layer (${e}) to node '${t.id}'`)}const v=function(e){const r=[],i=Math.max(...e.idescendants().map(t=>t.layer));for(const n of e){const e=n.layer;if((r[e]||(r[e]=[])).push(n),n.dataChildren=n.dataChildren.map(i=>{const o=i.child.layer;if(o<=e)throw new Error(`layering left child node "${i.child.id}" (${o}) with a greater or equal layer to parent node "${n.id}" (${e})`);let s=i.child;for(let a=o-1;a>e;a--){let e;e=t?`${n.id}->${i.child.id} (${a})`:`${n.id}\0${i.child.id}\0${a}`;const o=new oe(e);o.dataChildren.push(new u(s,void 0)),(r[a]||(r[a]=[])).push(o),s=o}return new u(s,i.data)}),0===n.dataChildren.length&&e<i){let e=new oe(t?`${n.id} (${i})`:`${n.id}\0${i}`);(r[i]||(r[i]=[])).push(e);for(let o=i-1;o>n.layer;o--){const s=new oe(t?`${n.id} (${i})`:`${n.id}\0${i}`);s.dataChildren.push(new u(e,void 0)),(r[o]||(r[o]=[])).push(s),e=s}n.dataChildren=[new u(e,void 0)]}}return r}(d);let m;if(1===v.length){const[t]=v;for(const e of t)e.y0=0,e.y1=1;m=1}else{const t=function(t){const e=new c;for(const r of t.idescendants("before")){const t=e.getDefault(r.id,0)+f(r);e.set(r.id,t);for(const i of r.ichildren()){const r=Math.max(t,e.getDefault(i.id,0));e.set(i.id,r)}}return e}(d);let e=v[0];const r=Math.max(...e.map(t=>p.getThrow(t.id)));for(const r of e){const e=r.y1=t.getThrow(r.id);r.y0=e-f(r)}m=0;for(const[r,i]of v.slice(1).entries()){m+=a(e,i,r);for(const e of i){const r=e.y1=m+t.getThrow(e.id);e.y0=r-f(e)}e=i}m+=r}n(v),o(v);for(const t of v)for(const e of t){if(void 0===e.columnIndex)throw new Error(`column did not assign an index to node '${e.id}'`);if(e.columnIndex<0)throw new Error(`column assigned a negative index (${e.columnIndex}) to node '${e.id}'`)}s(v,h,l);for(const t of v)for(const e of t){if(void 0===e.x0||void 0===e.x1)throw new Error(`coord did not assign both x coordinates to node '${e.id}'`);if(e.x0>e.x1)throw new Error(`coord did not assign valid x coordinates to node '${e.id}'`)}const g=d;return function(t,i){for(const n of t)n.x0*=e,n.x1*=e,n.y0*=r/i,n.y1*=r/i}(g,m),function(t){for(const e of t)if(!(e instanceof oe)){const t=[];for(const r of e.dataChildren){let i=r.child;const n=[{x:(e.x0+e.x1)/2,y:e.y1}];for(;void 0!==i&&i instanceof oe;)n.push({x:(i.x0+i.x1)/2,y:i.y0}),[i]=i.ichildren();if(void 0!==i){n.push({x:(i.x0+i.x1)/2,y:i.y0});const e=new u(i,r.data,n);t.push(e)}}e.dataChildren=t}}(g),g}return d.size=function(c){if(void 0===c)return[e,r];{const[e,r]=c;return se(t,e,r,i,n,o,s,a,h,l,f)}},d.layering=function(c){return void 0===c?i:se(t,e,r,c,n,o,s,a,h,l,f)},d.decross=function(c){return void 0===c?n:se(t,e,r,i,c,o,s,a,h,l,f)},d.column=function(c){return void 0===c?o:se(t,e,r,i,n,c,s,a,h,l,f)},d.coord=function(c){return void 0===c?s:se(t,e,r,i,n,o,c,a,h,l,f)},d.layerSeparation=function(c){return void 0===c?a:se(t,e,r,i,n,o,s,c,h,l,f)},d.columnWidth=function(c){return void 0===c?h:se(t,e,r,i,n,o,s,a,c,l,f)},d.columnSeparation=function(c){return void 0===c?l:se(t,e,r,i,n,o,s,a,h,c,f)},d}function ae(){return 1}function he(){return 10}function le(){return 1}function ce(t){if(t instanceof oe)return 0;if(function(t){const e=t.heightRatio;return void 0===e||"number"==typeof e}(t))return t.heightRatio||0;throw new Error("default height ratio expects node with heightRatio property but got nothing")}function ue(t){function e(e){const r=new c;for(const t of e)for(const e of t)for(const t of e.ichildren())r.setIfAbsent(t.id,[]).push(e);const i=Math.max(...e.map(t=>t.length)),n=e.findIndex(t=>t.length===i);for(const[t,r]of e[n].entries())r.columnIndex=t;for(const t of e.slice(0,n).reverse())o(t);for(const t of e.slice(n+1))s(t);function o(e){if(e.length===i)for(const[t,r]of e.entries())r.columnIndex=t;else{const r=a(e.map((e,r)=>{if(0===e.dataChildren.length)return r;const i=[...e.ichildren().map(t=>h(t.columnIndex))];return t?i.sort((t,e)=>t-e)[Math.floor((i.length-1)/2)]:Math.min(...i)}));for(const[t,i]of e.entries())i.columnIndex=r[t]}}function s(e){if(e.length===i)for(const[t,r]of e.entries())r.columnIndex=t;else{const i=a(e.map((e,i)=>{const n=r.getDefault(e.id,[]);if(0===n.length)return i;const o=n.map(t=>h(t.columnIndex));return t?o[Math.floor((o.length-1)/2)]:Math.min(...o)}));for(const[t,r]of e.entries())r.columnIndex=i[t]}}function a(t){for(const e of t)if(!isFinite(e))throw new Error("columnComplex: non-finite column index encountered");let e=-1;t=t.map(t=>(t<=e&&(t=e+1),e=t,t));const r=Math.max(...t)-(i-1);return r>0&&(t=t.map((t,e)=>Math.max(t-r,e))),t}}return e.center=function(e){return void 0===e?t:ue(e)},e}t.ArqDummyNode=oe,t.SugiDummyNode=qt,t.arqcoordSpread=ne,t.arquint=function(){return se(!1,1,1,Ht().topDown(!1),Bt(),ie(),ne(),ae,he,le,ce)},t.columnAdjacent=function(...t){if(t.length)throw new Error(`got arguments to adjacent(${t}), but constructor takes no aruguments.`);return ue(!1)},t.columnCenter=function(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return function(t){const e=Math.max(...t.map(t=>t.length));for(const r of t){const t=Math.floor((e-r.length)/2);for(const[e,i]of r.entries())i.columnIndex=t+e}}},t.columnComplex=ie,t.columnLeft=function(...t){if(t.length)throw new Error(`got arguments to left(${t}), but constructor takes no aruguments.`);return function(t){for(const e of t)for(const[t,r]of e.entries())r.columnIndex=t}},t.coordCenter=function(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return function(t,e){const r=Math.max(...t.map(t=>{let r=t[0],i=r.x=0;for(const n of t.slice(1))i=n.x=i+e(r,n),r=n;return i}));for(const e of t){const t=h(e[e.length-1].x)/2;for(const i of e)i.x=(h(i.x)-t)/r+.5}}},t.coordGreedy=function(...t){if(t.length)throw new Error(`got arguments to greedy(${t}), but constructor takes no aruguments.`);return function(t,e){const r=Yt,i=new c;for(const e of t)for(const t of e)i.set(t.id,t.ichildren().length+(t instanceof qt?-3:0));for(const e of t)for(const t of e)for(const e of t.ichildren())i.set(e.id,i.getThrow(e.id)+1);let[n,...o]=t,[s,...a]=n,l=s.x=0;for(const t of a)l=t.x=l+e(s,t),s=t;for(const t of o){r(n,t);const o=t.map((t,e)=>[e,t]).sort(([t,e],[r,n])=>{const o=i.getThrow(e.id),s=i.getThrow(n.id);return o===s?t-r:s-o});for(const[r,i]of o){let n=i,o=h(n.x);for(const i of t.slice(r+1))o=i.x=Math.max(h(i.x),o+e(n,i)),n=i;n=i,o=h(n.x);for(const i of t.slice(0,r).reverse())o=i.x=Math.min(h(i.x),o-e(i,n)),n=i}n=t}const u=Math.min(...t.map(t=>Math.min(...t.map(t=>h(t.x))))),f=Math.max(...t.map(t=>Math.max(...t.map(t=>h(t.x)))))-u;for(const e of t)for(const t of e)t.x=(h(t.x)-u)/f}},t.coordMinCurve=function(...t){if(t.length)throw new Error(`got arguments to minCurve(${t}), but constructor takes no aruguments.`);return Qt(.5)},t.coordTopological=function(...t){if(t.length)throw new Error(`got arguments to topological(${t}), but constructor takes no aruguments.`);return function(t,e){for(const e of t){if(1!==e.reduce((t,e)=>t+ +!(e instanceof qt),0))throw new Error("topological() only works with a topological layering")}const r=new c;let i=0;for(const e of t)for(const t of e)t instanceof qt&&r.set(t.id,i++);for(const e of t)for(const t of e)t instanceof qt||r.set(t.id,i);const[n,o,s,a]=St(t,r,e);for(const e of t)for(const t of e){const e=r.getThrow(t.id);for(const i of t.ichildren()){const t=r.getThrow(i.id);if(i instanceof qt)for(const o of i.ichildren()){Nt(n,e,t,r.getThrow(o.id),1)}}}Pt(t,r,_t(n,o,s,a))}},t.coordVert=Ft,t.dagConnect=function(...t){if(t.length)throw new Error(`got arguments to dagConnect(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagConnect()(...)`);return b(I,C)},t.dagHierarchy=function(...t){if(t.length)throw Error(`got arguments to dagHierarchy(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagHierarchy()(...)`);return B(E,V,M(V))},t.dagStratify=function(...t){if(t.length)throw Error(`got arguments to dagStratify(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return g(w,x,y(x))},t.decrossOpt=function(...t){if(t.length)throw new Error(`got arguments to opt(${t}), but constructor takes no aruguments.`);return Zt(!1)},t.decrossTwoLayer=Bt,t.layeringCoffmanGraham=function(...t){if(t.length)throw new Error(`got arguments to coffmanGraham(${t}), but constructor takes no aruguments.`);return Gt(0)},t.layeringLongestPath=Ht,t.layeringSimplex=vt,t.layeringTopological=function(...t){if(t.length)throw new Error(`got arguments to topological(${t}), but constructor takes no aruguments.`);return function(t){for(const[e,r]of t.idescendants("before").entries())r.layer=e}},t.sugiyama=function(...t){if(t.length)throw new Error(`got arguments to sugiyama(${t}), but constructor takes no aruguments.`);return Dt(vt(),Bt(),Ft(),!1,[1,1],Lt,!1)},t.twolayerMean=function(...t){if(t.length)throw new Error(`got arguments to mean(${t}), but constructor takes no aruguments.`);return function(t,e){const r=new c(e.map(t=>[t.id,new Kt]));for(const[e,i]of t.entries())for(const t of i.ichildren())r.getThrow(t.id).add(e);e.sort((t,e)=>r.getThrow(t.id).mean-r.getThrow(e.id).mean)}},t.twolayerMedian=It,t.twolayerOpt=function(...t){if(t.length)throw new Error(`got arguments to opt(${t}), but constructor takes no aruguments.`);return Xt(!1)},t.zherebko=function(...t){if(t.length)throw new Error(`got arguments to zherebko(${t}), but constructor takes no aruguments.`);return ee(1,1)},Object.defineProperty(t,"__esModule",{value:!0})}));
